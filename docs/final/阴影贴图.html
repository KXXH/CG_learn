<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>阴影贴图 | 图形学大作业报告</title>
    <meta name="description" content="基于WebGL的三维图形建模和漫游">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    
    <link rel="preload" href="/CG_learn/docs/final/assets/css/0.styles.492b58f9.css" as="style"><link rel="preload" href="/CG_learn/docs/final/assets/js/app.9262c028.js" as="script"><link rel="preload" href="/CG_learn/docs/final/assets/js/2.c5e08dac.js" as="script"><link rel="preload" href="/CG_learn/docs/final/assets/js/3.7660d8ea.js" as="script"><link rel="prefetch" href="/CG_learn/docs/final/assets/js/10.3fe40a96.js"><link rel="prefetch" href="/CG_learn/docs/final/assets/js/11.e746ede1.js"><link rel="prefetch" href="/CG_learn/docs/final/assets/js/12.0e00dc8f.js"><link rel="prefetch" href="/CG_learn/docs/final/assets/js/13.37140cfd.js"><link rel="prefetch" href="/CG_learn/docs/final/assets/js/4.0b227c26.js"><link rel="prefetch" href="/CG_learn/docs/final/assets/js/5.0d005b09.js"><link rel="prefetch" href="/CG_learn/docs/final/assets/js/6.bb1c9c1c.js"><link rel="prefetch" href="/CG_learn/docs/final/assets/js/7.9d01bb3a.js"><link rel="prefetch" href="/CG_learn/docs/final/assets/js/8.b4952fd0.js"><link rel="prefetch" href="/CG_learn/docs/final/assets/js/9.c46da452.js">
    <link rel="stylesheet" href="/CG_learn/docs/final/assets/css/0.styles.492b58f9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/CG_learn/docs/final/" class="home-link router-link-active"><!----> <span class="site-name">图形学大作业报告</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://kxxh.github.io/CG_learn/shadow/shadow.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  查看演示
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://kxxh.github.io/CG_learn/shadow/shadow.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  查看演示
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/CG_learn/docs/final/概述.html" class="sidebar-link">概述</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/CG_learn/docs/final/设计" class="sidebar-heading clickable open"><span>设计和实现</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/CG_learn/docs/final/阴影贴图.html" class="active sidebar-link">阴影贴图</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CG_learn/docs/final/阴影贴图.html#基本原理" class="sidebar-link">基本原理</a></li><li class="sidebar-sub-header"><a href="/CG_learn/docs/final/阴影贴图.html#设计思路" class="sidebar-link">设计思路</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CG_learn/docs/final/阴影贴图.html#精度问题" class="sidebar-link">精度问题</a></li><li class="sidebar-sub-header"><a href="/CG_learn/docs/final/阴影贴图.html#偏移问题" class="sidebar-link">偏移问题</a></li><li class="sidebar-sub-header"><a href="/CG_learn/docs/final/阴影贴图.html#软化阴影" class="sidebar-link">软化阴影</a></li><li class="sidebar-sub-header"><a href="/CG_learn/docs/final/阴影贴图.html#局限性" class="sidebar-link">局限性</a></li></ul></li><li class="sidebar-sub-header"><a href="/CG_learn/docs/final/阴影贴图.html#具体实现" class="sidebar-link">具体实现</a></li></ul></li><li><a href="/CG_learn/docs/final/光线设计.html" class="sidebar-link">光照模型的设计</a></li><li><a href="/CG_learn/docs/final/倒影效果.html" class="sidebar-link">倒影效果</a></li><li><a href="/CG_learn/docs/final/模型的点选和平移.html" class="sidebar-link">模型的点选和平移</a></li></ul></section></li><li><a href="/CG_learn/docs/final/总结.html" class="sidebar-link">总结</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="阴影贴图"><a href="#阴影贴图" class="header-anchor">#</a> 阴影贴图</h1> <h2 id="基本原理"><a href="#基本原理" class="header-anchor">#</a> 基本原理</h2> <p>使用传统的方法实现阴影效果的基本思想是：<em>太阳看不见阴影</em>。</p> <p><img src="/CG_learn/docs/final/assets/img/depth-map-generation.ee656290.svg" alt="阴影纹理映射示意图"></p> <p><img src="data:image/gif;base64,R0lGODlh3QDwAHcAMSH+GlNvZnR3YXJlOiBNaWNyb3NvZnQgT2ZmaWNlACH5BAEAAAAALAAAAADdAOwAhwAAAAAAAAsLCx0dHRISEgwMDBoaGhYWFhERERwcHBAQEA0NDQ8PDwoKChQUFBkZGRcXFx4eHgUFBR8fHxMTEwYGBgcHBwICAgMDAycnJy8vLzMzMzAwMCAgIDU1NTExMTc3NyEhISQkJDY2Nj4+Pjg4OD8/PygoKDs7Ozo6Oi4uLisrKyoqKiYmJiwsLC0tLTQ0NDIyMjk5OT09PSIiIiUlJTqQkFdXV0BAQEhISEFBQUVFRVtbW0dHR0xMTFpaWlVVVVFRUV1dXVhYWEREREZGRkpKSkJCQktLS09PT2ZmZnNzc39/f3d3d3l5eWBgYG5ubmpqamNjY3Z2dmtra3t7e3BwcGdnZ2FhYXJycmJiYmxsbGZmkGZmtmaQtmaQ22a2tma222a2/5BmZpBmkJBmtpCQZoiIiIODg5ycnJCQkJ+fn4eHh4WFhZSUlIqKio+Pj42NjZeXl5CQtpCQ25C2kJC2tp28tpC225C2/5DbkJDbtpDb25Db/7ZmkLZmtraQZraQkLaQtraQ27a2Zra2kL+/v6+vr6enp7a2tre3t6SkpLa227a2/7bbkLbbtrbb27bb/7b/trb/27b//9uQZtuQkNuQttu2Ztu2kNu2ttu229vbkNvbttfX19vb28fHx9/f38/Pz9vb/9v/ttv/29v///+2Zv+2kP+2tv/bkP/btv/b2///tv//2+/v7/f39+fn5////wECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwECAwj/AAEIHEgQB4AMCBMqXMiw4UINBglKnEixosWLGDNq3Mixo8ePHDdUyMGEiaGTKFOqXMlS5aGSHASAnEmzps2bOG12QCSr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" alt="绘制阴影的流程图"></p> <p>如图所示，如果将照相机放在光源位置，那么照相机所看到的即为光源所看到的场景。那么我们只要找出在这个场景中，光源看不到的片元，就是被阴影覆盖的片元。上述操作可以通过深度值来实现。具体的流程可见上图。</p> <h2 id="设计思路"><a href="#设计思路" class="header-anchor">#</a> <strong>设计思路</strong></h2> <p>由于阴影数据在镜面贴图和显示中都需要使用，因此必须首先计算。阴影贴图的着色器中，严格意义上只需要将坐标变换到正确位置，然后把z值保存即可。但为了调试方便，我还是为片元附上了颜色。</p> <h3 id="精度问题"><a href="#精度问题" class="header-anchor">#</a> 精度问题</h3> <p>在最初调试时，片元的<code>gl_FragColor</code>的RGB值为颜色，W值为深度。但发现精度不足。理论上8位浮点数 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mn>0</mn><mo separator="true">,</mo><mfrac><mrow><mn>2</mn><mn>5</mn><mn>5</mn></mrow><mrow><mn>2</mn><mn>5</mn><mn>6</mn></mrow></mfrac><mo>]</mo></mrow><annotation encoding="application/x-tex">[0,\frac{255}{256}]</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.845108em;"></span><span class="strut bottom" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathrm">2</span><span class="mord mathrm">5</span><span class="mord mathrm">6</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.394em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">2</span><span class="mord mathrm">5</span><span class="mord mathrm">5</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mclose">]</span></span></span></span> 能存放256位深度，但是实际上由下图可知，绝大部分[<a href="#_ftn1">1]</a>深度落在0.01的范围上。因此导致精度不足，阴影无法正常显示。于是使用32位数（RGBA）表示深度，实验发现效果良好[<a href="#_ftn2">2]</a>。</p> <p><img src="/CG_learn/docs/final/assets/img/Figure_1.446078d2.png" alt="理想状态下的深度渐进曲线"></p> <p><img src="/CG_learn/docs/final/assets/img/Figure_2.be79b246.png" alt="8位浮点数下的深度渐进曲线"></p> <h3 id="偏移问题"><a href="#偏移问题" class="header-anchor">#</a> 偏移问题</h3> <p>处理了精度问题，可以保证不会出现大部分深度值落在1上的问题。但是上述方法并不能实际解决阴影映射的问题。由于浮点数转化过程中的问题，会导致存储在RGBA中的深度值无法与矩阵计算出的片元-光源距离直接作相等比较，导致图形学中常见的马赫带或其他问题。在这里我遇到的问题是片元-光源距离始终大于深度值，可以通过下面两张图分析看出。</p> <p><img src="data:image/png;base64,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" alt="存储在RGBA中的深度值，指数放大600倍"></p> <p><img src="data:image/png;base64,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" alt="实际计算出的片元-光源距离"></p> <p>这时可以通过添加固定的偏移量的方法，消除这一误差。对于透视投影，我们选择了<code>0.00004</code>作为偏移量，实验结果比较理想。</p> <h3 id="软化阴影"><a href="#软化阴影" class="header-anchor">#</a> 软化阴影</h3> <p>通过上述步骤得到的阴影贴图，在实际显示的着色器中应用后，效果如下：</p> <p><img src="/CG_learn/docs/final/assets/img/soft_shadow_1.2aa2c682.png" alt="锯齿明显的阴影"></p> <p>可以发现，阴影有着很明显的锯齿，过渡非常不均匀。这主要是由于片元中的坐标值是连续插值得到的，而纹理数据却是离散的这一矛盾而产生的。我们可以通过增加帧缓存的大小并通过加入超采样的方式，来计算出更加柔和真实的阴影。下图是增加超采样后的阴影效果。</p> <p><img src="/CG_learn/docs/final/assets/img/soft_shadow_2.52f965f8.png" alt="柔和的阴影"></p> <p>我使用了非常简单的超采样算法。首先，设定帧缓存大小到<code>1024*1024</code>，其宽高都大约是显示分辨率的2倍。在片元着色器中，使用一个循环，计算出当前片元周围的16个像素点的深度值，换算出对应的阴影值，求其均值作为当前片元的阴影值。</p> <h3 id="局限性"><a href="#局限性" class="header-anchor">#</a> 局限性</h3> <blockquote><p>通过这种方式得到的阴影，永远都只能是硬阴影。</p></blockquote> <p>软阴影是由于光源具有大小而产生的。例如，现实生活中的日光灯，其光源形状是线性的长条，那么在其正下方的物体应该会产生许多较浅的阴影，而不是一个很深的阴影，因为在很大的范围内，日光灯都只有一部分能照到物体。但在我们的实现中，光源仅仅是摄像机放置的位置上的一个无穷小的点，点是没有大小的，因此对于所有片元都只有能照到和不能照到两种可能性。我们可以改变超采样算法，可以改变阴影覆盖的权重，但不能从根本上解决问题。使用光线追踪技术可以从根本上消灭这一问题。</p> <h2 id="具体实现"><a href="#具体实现" class="header-anchor">#</a> 具体实现</h2> <p>首先看生成深度数据的着色器。</p> <div class="language-GLSL extra-class"><pre class="language-glsl"><code><span class="token comment">//顶点着色器</span>
<span class="token keyword">attribute</span> <span class="token keyword">vec4</span> vPosition<span class="token punctuation">;</span>

<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> uModel<span class="token punctuation">;</span>	<span class="token comment">//模型变换矩阵</span>
<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> uWorld<span class="token punctuation">;</span>	<span class="token comment">//世界变换矩阵</span>
<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> uView<span class="token punctuation">;</span>		<span class="token comment">//视口变换</span>
<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> uProjection<span class="token punctuation">;</span>	<span class="token comment">//投影变换</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	gl_Position <span class="token operator">=</span> uProjection<span class="token operator">*</span>uView<span class="token operator">*</span>uWorld<span class="token operator">*</span>uModel<span class="token operator">*</span>vPosition<span class="token punctuation">;</span>	<span class="token comment">//直接计算坐标即可</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-GLSL extra-class"><pre class="language-glsl"><code><span class="token comment">//片元着色器</span>
<span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>
<span class="token keyword">uniform</span> <span class="token keyword">vec4</span> v_Color<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token keyword">vec4</span> bitShift <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">256.0</span><span class="token punctuation">,</span> <span class="token number">256.0</span><span class="token operator">*</span><span class="token number">256.0</span><span class="token punctuation">,</span> <span class="token number">256.0</span><span class="token operator">*</span><span class="token number">256.0</span><span class="token operator">*</span><span class="token number">256.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">vec4</span> bitMask <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token operator">/</span><span class="token number">256.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token operator">/</span><span class="token number">256.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token operator">/</span><span class="token number">256.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">vec4</span> rgbaDepth <span class="token operator">=</span> <span class="token function">fract</span><span class="token punctuation">(</span>gl_FragCoord<span class="token punctuation">.</span>z <span class="token operator">*</span> bitShift<span class="token punctuation">)</span><span class="token punctuation">;</span>
    rgbaDepth <span class="token operator">-</span><span class="token operator">=</span> rgbaDepth<span class="token punctuation">.</span>gbaa <span class="token operator">*</span> bitMask<span class="token punctuation">;</span>
    gl_FragColor<span class="token operator">=</span>rgbaDepth<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>实现的代码很简单，主要是通过给定变换矩阵算出顶点的坐标，在片元着色器中将深度值存入RGBA表示的片元颜色中。</p> <p>再来看绘制实际显示的图像的片元着色器：</p> <div class="language-GLSL extra-class"><pre class="language-glsl"><code><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//...</span>
	<span class="token comment">//计算出当前片元对应深度数据的坐标(-1,1)=&gt;(0,1)</span>
	<span class="token keyword">vec3</span> shadowCoord <span class="token operator">=</span> <span class="token punctuation">(</span>v_PositionFromLight<span class="token punctuation">.</span>xyz<span class="token operator">/</span>v_PositionFromLight<span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2.0</span> <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
	<span class="token comment">//...</span>
	<span class="token comment">//计算当前片元阴影值</span>
	<span class="token keyword">vec4</span> rgbaDepth<span class="token punctuation">;</span>
    <span class="token keyword">float</span> shadows<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> depth<span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">float</span> y<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1.5</span><span class="token punctuation">;</span>y<span class="token operator">&lt;=</span><span class="token number">1.5</span><span class="token punctuation">;</span>y<span class="token operator">+</span><span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">float</span> x<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1.5</span><span class="token punctuation">;</span>x<span class="token operator">&lt;=</span><span class="token number">1.5</span><span class="token punctuation">;</span>x<span class="token operator">+</span><span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        	<span class="token comment">//从深度数据纹理中提取并还原出深度数据</span>
            rgbaDepth<span class="token operator">=</span><span class="token function">texture2D</span><span class="token punctuation">(</span>u_ShadowMap<span class="token punctuation">,</span> shadowCoord<span class="token punctuation">.</span>xy<span class="token operator">+</span><span class="token keyword">vec2</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token operator">/</span>texelSize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            depth <span class="token operator">=</span> <span class="token function">unpackDepth</span><span class="token punctuation">(</span>rgbaDepth<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//不同投影方式需要不同的偏移值</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>uShadow_type<span class="token punctuation">)</span>
            	<span class="token comment">//如果当前片元深度比取出的深度数据大，则在阴影中</span>
                shadows<span class="token operator">+</span><span class="token operator">=</span><span class="token punctuation">(</span>shadowCoord<span class="token punctuation">.</span>z <span class="token operator">&gt;</span> depth <span class="token operator">+</span> <span class="token number">0.00004</span> <span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0.0</span> <span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                shadows<span class="token operator">+</span><span class="token operator">=</span><span class="token punctuation">(</span>shadowCoord<span class="token punctuation">.</span>z <span class="token operator">&gt;</span> depth <span class="token operator">+</span> <span class="token number">0.002</span> <span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0.0</span> <span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    shadows<span class="token operator">/</span><span class="token operator">=</span><span class="token number">16.0</span><span class="token punctuation">;</span>	<span class="token comment">//求均值</span>
    <span class="token comment">//...</span>
    gl_FragColor<span class="token punctuation">.</span>rgb <span class="token operator">*</span><span class="token operator">=</span> shadows<span class="token punctuation">;</span>   <span class="token comment">//阴影覆盖在漫反射项</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在WebGL的实现上，首先需要创建一个帧缓存，并把纹理绑定给全局变量：</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> attachments <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> format<span class="token punctuation">:</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> type<span class="token punctuation">:</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> min<span class="token punctuation">:</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> format<span class="token punctuation">:</span> gl<span class="token punctuation">.</span><span class="token constant">DEPTH_COMPONENT16</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
fbi <span class="token operator">=</span> twgl<span class="token punctuation">.</span><span class="token function">createFramebufferInfo</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>attachments<span class="token punctuation">,</span><span class="token number">1024</span><span class="token punctuation">,</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
light_uniform<span class="token punctuation">.</span>u_ShadowMap<span class="token operator">=</span>fbi<span class="token punctuation">.</span>attachments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>在渲染时，先切换到对应着色器程序，绑定帧缓存并绘图。绘图完成后还原帧缓存绑定，再使用主着色器程序就可以访问到纹理了。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      	<span class="token comment">//...</span>
        <span class="token comment">//绘制阴影</span>
        twgl<span class="token punctuation">.</span><span class="token function">bindFramebufferInfo</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>fbi<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span> <span class="token operator">|</span> gl<span class="token punctuation">.</span><span class="token constant">DEPTH_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>shadow_programInfo<span class="token punctuation">.</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//...</span>
        twgl<span class="token punctuation">.</span><span class="token function">setUniforms</span><span class="token punctuation">(</span>shadow_programInfo<span class="token punctuation">,</span> shadow_uniform<span class="token punctuation">)</span><span class="token punctuation">;</span>
        twgl<span class="token punctuation">.</span><span class="token function">setBuffersAndAttributes</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>shadow_programInfo<span class="token punctuation">,</span>boardBufferInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        twgl<span class="token punctuation">.</span><span class="token function">drawBufferInfo</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>boardBufferInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        twgl<span class="token punctuation">.</span><span class="token function">setBuffersAndAttributes</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> shadow_programInfo<span class="token punctuation">,</span> catBufferInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        twgl<span class="token punctuation">.</span><span class="token function">drawBufferInfo</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> catBufferInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
		<span class="token comment">//...</span>
        <span class="token comment">//绘制可见帧</span>
        twgl<span class="token punctuation">.</span><span class="token function">bindFramebufferInfo</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span> <span class="token operator">|</span> gl<span class="token punctuation">.</span><span class="token constant">DEPTH_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>programInfo<span class="token punctuation">.</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        twgl<span class="token punctuation">.</span><span class="token function">setUniforms</span><span class="token punctuation">(</span>programInfo<span class="token punctuation">,</span>light_uniform<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//...</span>
        twgl<span class="token punctuation">.</span><span class="token function">setBuffersAndAttributes</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> programInfo<span class="token punctuation">,</span> catBufferInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        twgl<span class="token punctuation">.</span><span class="token function">drawBufferInfo</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> catBufferInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        twgl<span class="token punctuation">.</span><span class="token function">setBuffersAndAttributes</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>programInfo<span class="token punctuation">,</span>boardBufferInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        twgl<span class="token punctuation">.</span><span class="token function">drawBufferInfo</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>boardBufferInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">//...</span>
       	<span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><hr> <p>[<a href="#_ftnref1">1]</a> 根据实验约有75%的值落在<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>9</mn><mn>9</mn><mo separator="true">,</mo><mn>1</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">[0.99,1]</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">9</span><span class="mord mathrm">9</span><span class="mpunct">,</span><span class="mord mathrm">1</span><span class="mclose">]</span></span></span></span>区间上，98.5%的值重复了</p> <p>[<a href="#_ftnref2">2]</a> 在检查的1000个样本中，没有深度数据重复</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/CG_learn/docs/final/概述.html" class="prev">概述</a></span> <span class="next"><a href="/CG_learn/docs/final/光线设计.html">光照模型的设计</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/CG_learn/docs/final/assets/js/app.9262c028.js" defer></script><script src="/CG_learn/docs/final/assets/js/2.c5e08dac.js" defer></script><script src="/CG_learn/docs/final/assets/js/3.7660d8ea.js" defer></script>
  </body>
</html>
