<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>模型的点选和平移 | 图形学大作业报告</title>
    <meta name="description" content="">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    
    <link rel="preload" href="/CG_learn/docs/final/assets/css/0.styles.59571a42.css" as="style"><link rel="preload" href="/CG_learn/docs/final/assets/js/app.4a3400f3.js" as="script"><link rel="preload" href="/CG_learn/docs/final/assets/js/2.c5e08dac.js" as="script"><link rel="preload" href="/CG_learn/docs/final/assets/js/4.025bfe78.js" as="script"><link rel="prefetch" href="/CG_learn/docs/final/assets/js/10.3fe40a96.js"><link rel="prefetch" href="/CG_learn/docs/final/assets/js/11.4daaa88f.js"><link rel="prefetch" href="/CG_learn/docs/final/assets/js/12.e59c79a6.js"><link rel="prefetch" href="/CG_learn/docs/final/assets/js/13.37140cfd.js"><link rel="prefetch" href="/CG_learn/docs/final/assets/js/3.7660d8ea.js"><link rel="prefetch" href="/CG_learn/docs/final/assets/js/5.0d005b09.js"><link rel="prefetch" href="/CG_learn/docs/final/assets/js/6.c3474ff0.js"><link rel="prefetch" href="/CG_learn/docs/final/assets/js/7.9d01bb3a.js"><link rel="prefetch" href="/CG_learn/docs/final/assets/js/8.b4952fd0.js"><link rel="prefetch" href="/CG_learn/docs/final/assets/js/9.5f0994d7.js">
    <link rel="stylesheet" href="/CG_learn/docs/final/assets/css/0.styles.59571a42.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/CG_learn/docs/final/" class="home-link router-link-active"><!----> <span class="site-name">图形学大作业报告</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/CG_learn/docs/final/概述.html" class="sidebar-link">概述</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/CG_learn/docs/final/设计" class="sidebar-heading clickable open"><span>设计和实现</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/CG_learn/docs/final/阴影贴图.html" class="sidebar-link">阴影贴图</a></li><li><a href="/CG_learn/docs/final/光线设计.html" class="sidebar-link">光照模型的设计</a></li><li><a href="/CG_learn/docs/final/倒影效果.html" class="sidebar-link">倒影效果</a></li><li><a href="/CG_learn/docs/final/模型的点选和平移.html" class="active sidebar-link">模型的点选和平移</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CG_learn/docs/final/模型的点选和平移.html#基本原理" class="sidebar-link">基本原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CG_learn/docs/final/模型的点选和平移.html#点选" class="sidebar-link">点选</a></li><li class="sidebar-sub-header"><a href="/CG_learn/docs/final/模型的点选和平移.html#平移" class="sidebar-link">平移</a></li></ul></li><li class="sidebar-sub-header"><a href="/CG_learn/docs/final/模型的点选和平移.html#设计思路" class="sidebar-link">设计思路</a></li><li class="sidebar-sub-header"><a href="/CG_learn/docs/final/模型的点选和平移.html#具体实现" class="sidebar-link">具体实现</a></li></ul></li></ul></section></li><li><a href="/CG_learn/docs/final/总结.html" class="sidebar-link">总结</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="模型的点选和平移"><a href="#模型的点选和平移" class="header-anchor">#</a> 模型的点选和平移</h1> <h2 id="基本原理"><a href="#基本原理" class="header-anchor">#</a> 基本原理</h2> <h3 id="点选"><a href="#点选" class="header-anchor">#</a> 点选</h3> <blockquote><p>模型的点击选中也是我们常常能看到的功能，在3D绘图软件和游戏中都有很广泛的应用。一般来说，实现它的方式有两种，一种是射线选择法，另一种则是我们使用的在帧缓存中存储特有颜色或id的方法。</p></blockquote> <p>射线选择法的基本原理就是，当点选某个像素时，我们看作从观察点向该方向发出一条射线。这条射线与哪个模型相交，就等于选中了哪个模型。射线选择法被许多著名的3D库使用，包括Three.js。射线选择法的好处是比较通用，但实现起来需要判断射线和片元的交点，比较繁琐。</p> <p>我们使用的方法是在用户点击画布时，离屏渲染一张图片，顶点着色器和实际显示所用的一致，片元着色器仅仅为片元涂上给定的颜色。通过<code>gl.readPixels</code>方法，就可以读出当前鼠标点击的位置的颜色，进而判断点中了什么模型。此时帧缓存中的图像如下图所示。</p> <p><img src="data:image/png;base64,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" alt="帧缓存中的图像"></p> <h3 id="平移"><a href="#平移" class="header-anchor">#</a> 平移</h3> <p>选中模型后就需要平移。最简单的做法是，将鼠标在x,y轴上的移动直接映射到模型的x,y轴平移上。但是我们的视点会移动，当其朝向不再朝向正z轴方向时，这一移动就会与用户的心理预期不符。如何修正这种偏移呢？我们使用投影-视图-世界-模型矩阵的乘积的逆矩阵，与鼠标移动的向量相乘，得到的值作为模型的平移参数。这样做的好处是，不论视点如何变化，用户的鼠标平移都会在屏幕上表现得方向一致。</p> <h2 id="设计思路"><a href="#设计思路" class="header-anchor">#</a> 设计思路</h2> <p>本事件的流程图如下：</p> <p><img src="data:image/png;base64,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" alt="点选流程图"></p> <p>加上跟踪球后的流程如图：</p> <p><img src="/CG_learn/docs/finalassets/img/pickup_and_move_flow.79d804bd.png" alt="跟踪球和平移结合"></p> <p>属于基本的流程控制和事件侦听，此处不过多叙述。</p> <h2 id="具体实现"><a href="#具体实现" class="header-anchor">#</a> 具体实现</h2> <p>顶点着色器和主着色器共用代码，因此略过。片段着色器的代码如下：</p> <div class="language-GLSL extra-class"><pre class="language-glsl"><code><span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>
<span class="token keyword">uniform</span> <span class="token keyword">vec4</span> v_Color<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	gl_FragColor<span class="token operator">=</span>v_Color<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其实十分类似产生阴影深度的着色器代码，只是改为附上颜色罢了。</p> <p>接下来是JavaScript中事件侦听的代码：</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">//鼠标点击事件</span>
canvas<span class="token punctuation">.</span><span class="token function-variable function">onmousedown</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">var</span> bbox <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> x <span class="token operator">=</span> event<span class="token punctuation">.</span>clientX <span class="token operator">-</span> bbox<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
      <span class="token keyword">var</span> y <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height<span class="token operator">-</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>clientY <span class="token operator">-</span> bbox<span class="token punctuation">.</span>top<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      twgl<span class="token punctuation">.</span><span class="token function">bindFramebufferInfo</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>fbi2<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> readout<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">*</span><span class="token number">1</span><span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//绘制hit帧</span>
      twgl<span class="token punctuation">.</span><span class="token function">bindFramebufferInfo</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>fbi2<span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span> <span class="token operator">|</span> gl<span class="token punctuation">.</span><span class="token constant">DEPTH_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>hit_programInfo<span class="token punctuation">.</span>program <span class="token punctuation">)</span><span class="token punctuation">;</span>
      twgl<span class="token punctuation">.</span><span class="token function">setUniforms</span><span class="token punctuation">(</span>hit_programInfo<span class="token punctuation">,</span>light_uniform<span class="token punctuation">)</span><span class="token punctuation">;</span>
      twgl<span class="token punctuation">.</span><span class="token function">setBuffersAndAttributes</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> hit_programInfo<span class="token punctuation">,</span> catBufferInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
      twgl<span class="token punctuation">.</span><span class="token function">setUniforms</span><span class="token punctuation">(</span>hit_programInfo<span class="token punctuation">,</span> cat_uniforms<span class="token punctuation">)</span><span class="token punctuation">;</span>
      twgl<span class="token punctuation">.</span><span class="token function">setUniforms</span><span class="token punctuation">(</span>hit_programInfo<span class="token punctuation">,</span> projection_uniforms<span class="token punctuation">)</span><span class="token punctuation">;</span>
      twgl<span class="token punctuation">.</span><span class="token function">setUniforms</span><span class="token punctuation">(</span>hit_programInfo<span class="token punctuation">,</span> view_uniforms<span class="token punctuation">)</span><span class="token punctuation">;</span>
      twgl<span class="token punctuation">.</span><span class="token function">drawBufferInfo</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> catBufferInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

      twgl<span class="token punctuation">.</span><span class="token function">setBuffersAndAttributes</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>hit_programInfo<span class="token punctuation">,</span>boardBufferInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
      board_uniform<span class="token punctuation">.</span>uWorld<span class="token operator">=</span>twgl<span class="token punctuation">.</span>m4<span class="token punctuation">.</span><span class="token function">setTranslation</span><span class="token punctuation">(</span>twgl<span class="token punctuation">.</span>m4<span class="token punctuation">.</span><span class="token function">identity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      twgl<span class="token punctuation">.</span><span class="token function">setUniforms</span><span class="token punctuation">(</span>hit_programInfo<span class="token punctuation">,</span> board_uniform<span class="token punctuation">)</span><span class="token punctuation">;</span>
      twgl<span class="token punctuation">.</span><span class="token function">setUniforms</span><span class="token punctuation">(</span>hit_programInfo<span class="token punctuation">,</span> projection_uniforms<span class="token punctuation">)</span><span class="token punctuation">;</span>
      twgl<span class="token punctuation">.</span><span class="token function">setUniforms</span><span class="token punctuation">(</span>hit_programInfo<span class="token punctuation">,</span> view_uniforms<span class="token punctuation">)</span><span class="token punctuation">;</span>
      twgl<span class="token punctuation">.</span><span class="token function">drawBufferInfo</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>boardBufferInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl<span class="token punctuation">.</span><span class="token function">readPixels</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span>readout<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>readout<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_cat</span><span class="token punctuation">(</span>readout<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            mouseFlag<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
            catMove<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
            lastMousePosX<span class="token operator">=</span>x<span class="token punctuation">;</span>
            lastMousePosY<span class="token operator">=</span>y<span class="token punctuation">;</span>
            cat_uniforms<span class="token punctuation">.</span>u_texture<span class="token operator">=</span>tex3<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            mouseFlag<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
            trackBall<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
            lastMousePosX<span class="token operator">=</span>x<span class="token punctuation">;</span>
            lastMousePosY<span class="token operator">=</span>y<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      twgl<span class="token punctuation">.</span><span class="token function">bindFramebufferInfo</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//鼠标滚轮事件</span>
canvas<span class="token punctuation">.</span><span class="token function-variable function">onmousewheel</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
      event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> dy<span class="token operator">=</span>event<span class="token punctuation">.</span>deltaY<span class="token punctuation">;</span>
      camera_uniform<span class="token punctuation">.</span>u_viewWorldPosition<span class="token operator">=</span>twgl<span class="token punctuation">.</span>m4<span class="token punctuation">.</span><span class="token function">transformPoint</span><span class="token punctuation">(</span>twgl<span class="token punctuation">.</span>m4<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>twgl<span class="token punctuation">.</span>m4<span class="token punctuation">.</span><span class="token function">identity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>dy<span class="token operator">*</span><span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>camera_uniform<span class="token punctuation">.</span>u_viewWorldPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//鼠标移动事件</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mousemove&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>mouseFlag<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> bbox <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> x <span class="token operator">=</span> event<span class="token punctuation">.</span>clientX <span class="token operator">-</span> bbox<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
    <span class="token keyword">var</span> y <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height<span class="token operator">-</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>clientY <span class="token operator">-</span> bbox<span class="token punctuation">.</span>top<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>height<span class="token operator">/</span>bbox<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> dx<span class="token operator">=</span>x<span class="token operator">-</span>lastMousePosX<span class="token punctuation">;</span>
    <span class="token keyword">var</span> dy<span class="token operator">=</span>y<span class="token operator">-</span>lastMousePosY<span class="token punctuation">;</span>
    <span class="token keyword">var</span> ratio_x<span class="token operator">=</span><span class="token punctuation">(</span>x<span class="token operator">-</span>lastMousePosX<span class="token punctuation">)</span><span class="token operator">/</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
    <span class="token keyword">var</span> ratio_y<span class="token operator">=</span><span class="token punctuation">(</span>y<span class="token operator">-</span>lastMousePosY<span class="token punctuation">)</span><span class="token operator">/</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>catMove<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> offset<span class="token operator">=</span>twgl<span class="token punctuation">.</span>m4<span class="token punctuation">.</span><span class="token function">transformPoint</span><span class="token punctuation">(</span>invMat<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.01</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        offset<span class="token operator">=</span>twgl<span class="token punctuation">.</span>v3<span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span>twgl<span class="token punctuation">.</span>m4<span class="token punctuation">.</span><span class="token function">transformPoint</span><span class="token punctuation">(</span>invMat<span class="token punctuation">,</span><span class="token punctuation">[</span>dx<span class="token punctuation">,</span>dy<span class="token punctuation">,</span><span class="token number">0.01</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>light_uniform<span class="token punctuation">.</span>uShadow_type<span class="token punctuation">)</span><span class="token punctuation">{</span>
            twgl<span class="token punctuation">.</span>v3<span class="token punctuation">.</span><span class="token function">divide</span><span class="token punctuation">(</span>offset<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">]</span><span class="token punctuation">,</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">changeCatLocation</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ratioX<span class="token punctuation">,</span>ratioY<span class="token punctuation">,</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> r_x <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">*</span>x <span class="token operator">*</span> <span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>width<span class="token operator">/</span>bbox<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token operator">/</span>canvas<span class="token punctuation">.</span>width<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> r_y <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">*</span>y<span class="token operator">/</span>canvas<span class="token punctuation">.</span>height<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> last_rx<span class="token operator">=</span><span class="token number">2</span><span class="token operator">*</span>lastMousePosX<span class="token operator">*</span><span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>width<span class="token operator">/</span>bbox<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token operator">/</span>canvas<span class="token punctuation">.</span>width<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> last_ry<span class="token operator">=</span><span class="token number">2</span><span class="token operator">*</span>lastMousePosY<span class="token operator">/</span>canvas<span class="token punctuation">.</span>height<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> ans <span class="token operator">=</span> <span class="token function">mouseMotion</span><span class="token punctuation">(</span>r_x<span class="token punctuation">,</span>last_ry<span class="token punctuation">,</span>last_rx<span class="token punctuation">,</span>r_y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        camera_uniform<span class="token punctuation">.</span>u_viewWorldPosition<span class="token operator">=</span>twgl<span class="token punctuation">.</span>m4<span class="token punctuation">.</span><span class="token function">transformPoint</span><span class="token punctuation">(</span>twgl<span class="token punctuation">.</span>m4<span class="token punctuation">.</span><span class="token function">axisRotate</span><span class="token punctuation">(</span>twgl<span class="token punctuation">.</span>m4<span class="token punctuation">.</span><span class="token function">identity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>ans<span class="token punctuation">.</span>axis<span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">*</span>ans<span class="token punctuation">.</span>angle<span class="token punctuation">)</span><span class="token punctuation">,</span>camera_uniform<span class="token punctuation">.</span>u_viewWorldPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    lastMousePosX<span class="token operator">=</span>x<span class="token punctuation">;</span>
    lastMousePosY<span class="token operator">=</span>y<span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/CG_learn/docs/final/倒影效果.html" class="prev">倒影效果</a></span> <span class="next"><a href="/CG_learn/docs/final/总结.html">总结</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/CG_learn/docs/final/assets/js/app.4a3400f3.js" defer></script><script src="/CG_learn/docs/final/assets/js/2.c5e08dac.js" defer></script><script src="/CG_learn/docs/final/assets/js/4.025bfe78.js" defer></script>
  </body>
</html>
